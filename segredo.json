<?php
$secret = "@embra8080z";
$header = "X-Hub-Signature";

// Signature do GitHub
$githubSignature = $_SERVER['HTTP_' . str_replace('-', '_', strtoupper($header))];

if ($githubSignature) {
  $payload = file_get_contents('php://input');
  $signature = 'sha1=' . hash_hmac('sha1', $payload, $secret, false);

  // Checa se a signature é válida
  if (hash_equals($signature, $githubSignature)) {
    // Comando para atualizar o repositório
    shell_exec('cd /home/primeiro/public_html && git pull');
    echo 'Repositório atualizado com sucesso';
  } else {
    // Signature inválida
    header('HTTP/1.0 403 Forbidden');
    die('Signature inválida');
  }
} else {
  // Header não encontrado
  header('HTTP/1.0 400 Bad Request');
  die('HTTP header ' . $header . ' não está definido.');
}
?>
